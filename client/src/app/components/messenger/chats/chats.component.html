<div *ngIf="loading()">Loading chats...</div>
<div *ngIf="error()" class="error">{{ error() }}</div>
<div class="chat-items">
  @for (chat of allChats(); track trackByChatId($index, chat)) {
    <div class="chat-item"
      [class.active]="chat.id === currentChatId"
      (click)="selectChat(chat.id)">
      <div class="chat-avatar">
        <img *ngIf="chat.avatar" [src]="chat.avatar" [alt]="getChatName(chat)" />
        <div *ngIf="!chat.avatar">C</div>
      </div>
      <div class="chat-info">
        <div class="chat-name">{{ getChatName(chat) }}</div>
        <div class="chat-last-message">{{ chat.lastMessage || 'Нет сообщений' }}</div>
      </div>
      <div class="d-flex flex-column align-end">
        <div class="chat-time">{{ chat.time || formatTime(chat.updatedAt) }}</div>
        @if (chat.unreadCount > 0) {
          <div class="chat-unread">{{ chat.unreadCount }}</div>
        }
      </div>
    </div>
  }
</div>
